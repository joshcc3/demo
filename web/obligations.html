<!DOCTYPE html>
<html>
<head>
    <title>RFQ Obligations</title>
    <script src="js/jquery-1.4.2.js"></script>
    <script src="js/jquery-extras.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/websocket-ui.js"></script>
    <script src="js/error-catcher.js"></script>
    <script src="launcher.js"></script>
    <style>
        #obligations td {
            background-color: darkgray;
        }
        .template {
            display: none !important;
        }
        body {
            background-color: #d4d0c7;
            color: white;;
            font-size: 10px;
            font-family: verdana, tahoma, arial, serif;
        }

    </style>
    <script type="text/javascript">
        var Contracts = {};

        $(function () {
            ws = connect();
            ws.logToConsole = false;
            ws.onmessage = function (x) {
                eval(x);
            };
        });


        function addContract(symbol) {
            if (!Contracts.hasOwnProperty(symbol)) {
                var row = $("#obligations").find('tr.template').clone().removeClass('template');
                Contracts[symbol] = row;
                row.find('.symbol')
                    .text(symbol)
                    .bind('click', function () {
                        launchLadder(symbol)
                    });
                row.data('symbol', symbol);
                $('#obligations').addSorted(row, function (a, b) {
                    a = $(a);
                    b = $(b);
                    return a.data('symbol') < b.data('symbol') ? -1 : a.data('symbol') == b.data('symbol') ? 0 : 1;
                });
            }
        }


        function hide(symbol) {
            var row = Contracts[symbol];
            delete Contracts[symbol];
            if (row) {
                $(row).delete();
            }
        }

        function update(symbol, missingBids, missingAsks) {
            addContract(symbol);
            var row = Contracts[symbol];
            row.find('.bpsTop').text(JSON.stringify(missingBids));
            row.find('.eurTop').text(JSON.stringify(missingAsks));
        }

    </script>
</head>
<body>
<table>
    <thead>
    <tr class="header_row">
        <th>Symbol
        </th>
        <th>Tight Bps</th>
        <th>Tight Eur</th>
        <th>Max Bps</th>
        <th>Max Eur</th>
    </tr>
    </thead>
    <tbody id="obligations">
    <tr class="template">
        <td class="symbol"></td>
        <td class="bpsTop bps"></td>
        <td class="eurTop"></td>
        <td class="bpsMax bps"></td>
        <td class="eurMax"></td>
    </tr>
    </tbody>
</table>
</body>
</html>
